# UB Talker
## 1. Setting up a development environment
### 1.1 Required software
- [Visual Studio](https://www.visualstudio.com/vs/community/)
- [Git](https://git-scm.com/)
- A bitbucket account

### 1.2 Cloning the repository

1. Navigate to a directory where you want to keep your workspace, and clone the repository:
>`$ git clone https://<your bitbucket name here>@bitbucket.org/ubtalker/ubtalker.git`

2. Open the file `UBTalker.sln` in the local repository root.

## 2. Project Structure

### 2.1 `~`

Hidden files:
- `EyeXFramework.dll` - Compiled EyeXFramework, referenced by UBTalker for Eye Gaze Device support
- `EyeXFramework.pbd`
- `EyeXFramework.xml`
- `Tobii.EyeX.Client.dll` - Native library used by EyeXFramework
- `Tobii.EyeX.Client.Net20.dll`
- `Tobii.EyeX.Client.Net20.xml`

Code:
- `App.xaml.cs` - Pseudo-entry-point for the program. Actual entry point is generated by project. This handles bootstrapping the EyeX device and Dependency Injection system, as well as service registration.
- `MainWindow.xaml.cs` - Main window, includes call light button and a frame for the current view.
- `IKeyboardReceiver.cs` - Implemented by views that require feedback from a keyboard

### 2.2 `~/Services`

Create your services here. They should consist of (at least) an interface and an implementation in the form of `IService.cs` and `Service.cs`.

### 2.3 `~/Views`

Define your views here.

### 2.4 `~/Controls`

Contains reusable controls.

## 3. Creating a new module (Service + View)

### 3.1 Setup

1. Define your service in `~/Services`. Create at least an interface and implementation file.
2. Register your service in `App.xaml.cs` inside the method `RegisterServices()`.
```csharp
RegisterSingleton<IServiceInterface, ServiceImplementationClass>();
```
3. Create a view for your module in `~/Views`. This view should extend the `Page` class.
4. Inside the class, inject the service or services you wish to use, as well as the `IMainWindow`. The IMainWindow allows the view to request keyboard or modal access.
```csharp
private readonly IMainWindow _parent = ServiceLocator.Current.GetInstance<IMainWindow>();
private readonly IPhraseService _phraseService = ServiceLocator.Current.GetInstance<IPhraseService>();
```
5. Add your view to the hub page under the method `private List<GazeButtonData[]> GetOptions()`. Note that there are 4 items per page.
```csharp
private List<GazeButtonData[]> GetOptions()
{
    List<GazeButtonData[]> options = new List<GazeButtonData[]>();
    options.Add(new GazeButtonData[] {
        new GazeButtonData("Phrases", "/Views/PhrasesView.xaml"),
        new GazeButtonData("Keyboard", "cmd:keyboard"),
        new GazeButtonData("New View", "/View/YourNewView.xaml"), // YOUR NEW VIEW TITLE AND PATH <---
        new GazeButtonData("")
    });
    return options;
}
```
6. (OPTIONAL) Add keyboard support. Have your View class implement `IKeyboardReceiver`. To open and pass control to the keyboard, make sure you have `IMainWindow` injected (for sake of example, call it `_parent`), and call `_parent.ShowKeyboard()`. Your view will be taken down, control will be passed to the Keyboard, and one of your callbacks will be called once it finishes.
7. (OPTIONAL) Add modal support. Similar to above, except call `_parent.ShowModal("Your message here")`.
8. In your view, you need to add the UBTalker component namespace. To do so, in the root XML tag, add the following namespace declaration:
```xml
<Page
    ...
    xmlns:control="clr-namespace:UBTalker.Controls"
    ...>
```

### 3.2 Using XAML components

#### 3.2.1 GazeButton

To use a `GazeButton`, create the component:
```xml
    <control:GazeButton />
```
For an example of a full list of GazeButton-specific attributes,
```xml
    <control:GazeButton
        GazeFocusDelay="200"
        GazeSelectionDelay="1000"
        Text=""
        Link="" />
```
Note that `Link` is just metadata for the surrounding application to use, and will _not_ be treated like a link when clicked by default. While the `Text` attribute is used for display, `Link` should be used internally to identify the specific request.

To listen for events,
```xml
    <control:GazeButton
        GazeFocus="Your_Method_Name_Here"
        GazeSelect="Your_Other_Method_Name_Here" />
```

#### 3.2.2 PagedGazeMenu

To use a `PagedGazeMenu`, create the component:
```xml
    <control:PagedGazeMenu />
```

To listen in on a selection,
```xml
    <control:PagedGazeMenu GazeSelect="Your_Method_Name_Here" />
```

## 4. Service Lifecycle

Services are created on startup, and are _not_ destroyed, unlike views. A single instance will live for the entire duration of the application. You should also ensure that a service cannot crash the rest of the application. All errors should be handled within the service, as well as error recovery if possible.